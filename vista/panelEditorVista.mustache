<main class="w-full p-8 flex flex-col gap-8 text-[#E2E4F3]">
  <h1 class="text-3xl font-bold border-b-2 border-[#2c2f56] pb-3">Panel del Editor</h1>
    <div class="flex gap-4 mb-6">
    <button id="btnPreguntas" type="button"
      class="tab-btn px-5 py-2 rounded-lg font-semibold border border-[#BC6BE8] text-[#FFFFFF] hover:bg-[#BC6BE8]/20 transition"
      onclick="mostrarSeccion('preguntas')">
      Preguntas
    </button>
    <button id="btnReportes" type="button"
      class="tab-btn px-5 py-2 rounded-lg font-semibold border border-[#BC6BE8] text-[#FFFFFF] hover:bg-[#BC6BE8]/20 transition"
      onclick="mostrarSeccion('reportes')">
      Reportes
    </button>
    <button id="btnSugerencias" type="button"
      class="tab-btn px-5 py-2 rounded-lg font-semibold border border-[#BC6BE8]/40 text-[#FFFFFF]/70 hover:bg-[#BC6BE8]/10 transition"
      onclick="mostrarSeccion('sugerencias')">
      Sugerencias
    </button>
  </div>

  <!-- ===== BOTÓN DESPLEGAR FORMULARIO SOLO EN SECCIÓN PREGUNTAS ===== -->
  <section id="seccion-preguntas-top">
    <button 
      onclick="toggleFormulario()" 
      class="w-fit py-3 px-6 rounded-lg bg-gradient-to-r from-[#E65895] to-[#BC6BE8] font-semibold text-white hover:opacity-90 active:opacity-80 transition flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
        <path fill-rule="evenodd" d="M12 2.25a9.75 9.75 0 1 0 9.75 9.75A9.76 9.76 0 0 0 12 2.25Zm0 18a8.25 8.25 0 1 1 8.25-8.25A8.26 8.26 0 0 1 12 20.25ZM12.75 7.5a.75.75 0 0 0-1.5 0v4.5H7.5a.75.75 0 0 0 0 1.5h3.75v3.75a.75.75 0 0 0 1.5 0V13.5H16.5a.75.75 0 0 0 0-1.5h-3.75Z" clip-rule="evenodd"/>
      </svg>
      Agregar Nueva Pregunta
    </button>

    <!-- ===== FORMULARIO NUEVA PREGUNTA ===== -->
    <section id="formulario" class="bg-[#2c2f56] rounded-xl p-6 shadow-xl hidden transition-all duration-300">
      <h2 class="text-2xl font-semibold mb-4 text-[#BC6BE8] flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
          <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75S6.615 21.75 12 21.75 21.75 17.385 21.75 12 17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
        </svg>
        Nueva Pregunta
      </h2>

  <form action="/paneleditor/guardar" method="POST" class="flex flex-col gap-4">
      <div>
        <label class="block text-sm mb-1 text-gray-300">Descripción</label>
        <textarea name="descripcion" rows="3" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white focus:outline-none focus:ring-2 focus:ring-[#BC6BE8]"></textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1 text-gray-300">Categoría</label>
          <select name="id_categoria" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
            <option value="">Seleccionar...</option>
            <option value="1">Geografía</option>
            <option value="2">Historia</option>
            <option value="3">Ciencia</option>
            <option value="4">Deportes</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-300">Dificultad</label>
          <select name="id_dificultad" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
            <option value="">Seleccionar...</option>
            <option value="1">Fácil</option>
            <option value="2">Media</option>
            <option value="3">Difícil</option>
          </select>
        </div>
      </div>

      <!-- ===== RESPUESTAS ===== -->
      <div class="mt-2">
        <h3 class="text-lg font-semibold text-[#BC6BE8] mb-2">Respuestas</h3>
        <div class="flex flex-col gap-2">
          <div>
            <label class="block text-sm mb-1 text-green-400">Respuesta correcta:</label>
            <input type="text" name="respuesta_correcta" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 1:</label>
            <input type="text" name="respuesta_incorrecta1" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 2:</label>
            <input type="text" name="respuesta_incorrecta2" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 3:</label>
            <input type="text" name="respuesta_incorrecta3" class="w-full bg-[#1e1f3b] border border-[#3f4477] rounded-lg p-2 text-white">
          </div>
        </div>
      </div>

      <button type="submit" class="mt-4 py-3 px-6 rounded-lg bg-gradient-to-r from-[#E65895] to-[#BC6BE8] font-semibold text-white hover:opacity-90 active:opacity-80 transition">
        Guardar Pregunta
      </button>
    </form>
  
  </section>

    <!-- ===== LISTADO DE PREGUNTAS EXISTENTES ===== -->
    <section id="seccion-preguntas">
    <h2 class="text-2xl font-semibold mb-4 text-[#BC6BE8] flex items-center gap-2">
      Listado de Preguntas
    </h2>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-[#2c2f56] text-[#E2E4F3]">
            <th class="p-3 text-left">ID</th>
            <th class="p-3 text-left">Descripción</th>
            <th class="p-3 text-left">Categoría</th>
            <th class="p-3 text-left">Dificultad</th>
            <th class="p-3 text-center">Aprobada</th>
            <th class="p-3 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody class="text-gray-300">
          {{#preguntas}}
          <tr class="border-b border-[#3f4477] hover:bg-[#3f4477] transition">
            <td class="p-3">{{id}}</td>
            <td class="p-3">{{descripcion}}</td>
            <td class="p-3">{{categoria}}</td>
            <td class="p-3">{{dificultad}}</td>
            <td class="p-3 text-center">
              {{#aprobada}}
                <span class="text-green-400 font-semibold">Sí</span>
              {{/aprobada}}
              {{^aprobada}}
                <span class="text-red-400 font-semibold">No</span>
              {{/aprobada}}
            </td>
            <td class="p-3 flex justify-center gap-2">
              <a href="/editorpregunta/editar/{{id}}" class="px-3 py-1 bg-[#BC6BE8] rounded-lg hover:opacity-80 transition text-white">Editar</a>
              <button onclick="abrirModalEliminarInline({{id}})" data-action="eliminar" data-id="{{id}}" class="px-3 py-1 bg-red-600 rounded-lg hover:bg-red-700 transition text-white">Eliminar</button>
            </td>
          </tr>
          {{/preguntas}}
        </tbody>
      </table>
      {{^preguntas}}
        <p class="text-gray-400">NO HAY PREGUNTAS</p>
      {{/preguntas}}
    </div>
  </section>

  <!-- ===== SECCIÓN REPORTES ===== -->
<section id="seccion-reportes" class="hidden">
  <h2 class="text-2xl font-semibold mb-4 text-[#BC6BE8] flex items-center gap-2">
    Preguntas Reportadas
  </h2>
  <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-[#2c2f56] text-[#E2E4F3]">
            <th class="p-3 text-left">ID</th>
            <th class="p-3 text-left">Pregunta</th>
            <th class="p-3 text-left">Motivo</th>
            <th class="p-3 text-center">Acción</th>
          </tr>
      </thead>
      <tbody class="text-gray-300">
        {{#reportes}}
        <tr class="border-b border-[#3f4477] hover:bg-[#3f4477] transition">
          <td class="p-3">{{id_reporte}}</td>
          <td class="p-3">{{pregunta}}</td>
          <td class="p-3">{{descripcion}}</td>
          <td class="p-3 text-center">
            <button onclick="abrirModalVerReporte({{id_reporte}})" class="px-4 py-2 rounded-lg bg-[#3b82f6] hover:bg-[#2563eb] text-white">Ver</button>
          </td>
        </tr>
        {{/reportes}}
        {{^reportes}}
        <tr>
          <td class="p-3 text-gray-400" colspan="3">NO HAY REPORTES</td>
        </tr>
        {{/reportes}}
      </tbody>
    </table>
  </div>
</section>

  <!-- Modal para ver reporte (mostrar pregunta + motivo + acciones) -->
  <div id="modalVerReporte" class="fixed inset-0 bg-black bg-opacity-50 hidden items-start md:items-center justify-center z-50 p-4">
    <div class="bg-[#1e1f3b] rounded-lg p-6 w-full max-w-2xl text-white shadow-lg max-h-[85vh] overflow-y-auto">
      <h3 class="text-xl font-semibold mb-3">REPORTE: <span id="modalReporteId">-</span></h3>
      <div id="modalReporteContenido" class="flex flex-col gap-4">
        <input type="hidden" id="reporte_id_field" value="">
        <input type="hidden" id="reporte_pregunta_id" value="">
        <div>
          <label class="block text-sm mb-1 text-gray-300">Pregunta</label>
          <textarea id="reporte_pregunta_descripcion" rows="3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly></textarea>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm mb-1 text-gray-300">Categoría</label>
            <input id="reporte_pregunta_categoria" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-gray-300">Dificultad</label>
            <input id="reporte_pregunta_dificultad" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
        </div>
        <div>
          <h4 class="text-lg font-semibold text-[#BC6BE8] mb-2">Respuestas</h4>
          <div class="flex flex-col gap-2">
            <div>
              <label class="block text-sm mb-1 text-green-400">Respuesta correcta:</label>
              <input id="reporte_rta_correcta" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
            </div>
            <div>
              <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 1:</label>
              <input id="reporte_rta_1" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
            </div>
            <div>
              <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 2:</label>
              <input id="reporte_rta_2" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
            </div>
            <div>
              <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 3:</label>
              <input id="reporte_rta_3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
            </div>
          </div>
        </div>

        <div>
          <label class="block text-sm mb-1 text-gray-300">Motivo del reporte</label>
          <textarea id="reporte_motivo" rows="3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly></textarea>
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-4">
        <form id="formEliminarDesdeReporte" action="/paneleditor/eliminar" method="POST" style="display:inline-block;">
          <input type="hidden" name="id" id="formEliminar_pregunta_id" value="">
          <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white">Eliminar Pregunta</button>
        </form>
        <form id="formQuitarReporte" action="/paneleditor/rechazarReporte" method="POST" style="display:inline-block;">
          <input type="hidden" name="id_reporte" id="formQuitar_id_reporte" value="">
          <button type="submit" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white">Quitar Reporte</button>
        </form>
        <button onclick="cerrarModalVerReporte()" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-700">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ===== SECCIÓN SUGERENCIAS ===== -->
  <section id="seccion-sugerencias" class="hidden">
    <h2 class="text-2xl font-semibold mb-4 text-[#BC6BE8] flex items-center gap-2">
      Preguntas Sugeridas
    </h2>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-[#2c2f56] text-[#E2E4F3]">
            <th class="p-3 text-left">ID</th>
            <th class="p-3 text-left">Descripción</th>
            <th class="p-3 text-left">Categoría</th>
            <th class="p-3 text-left">Dificultad</th>
            <th class="p-3 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody class="text-gray-300">
          {{#sugerencias}}
          <tr class="border-b border-[#3f4477] hover:bg-[#3f4477] transition">
            <td class="p-3">{{id}}</td>
            <td class="p-3">{{descripcion}}</td>
            <td class="p-3">{{categoria}}</td>
            <td class="p-3">{{dificultad}}</td>
            <td class="p-3 flex justify-center gap-2">
              <button onclick="abrirModalVerSugerencia({{id}})" class="px-4 py-2 rounded-lg bg-[#3b82f6] hover:bg-[#2563eb] text-white">Ver</button>
            </td>
          </tr>
          {{/sugerencias}}
          {{^sugerencias}}
          <tr>
            <td class="p-3 text-gray-400" colspan="5">NO HAY SUGERENCIAS</td>
          </tr>
          {{/sugerencias}}
        </tbody>
      </table>
      <!-- DEBUG: sugerencias (debug removed to avoid Mustache array rendering) -->
    </div>
  </section>

</main>
<!-- Modal para ver sugerencia (solo lectura) -->
<div id="modalVerSugerencia" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-[#1e1f3b] rounded-lg p-6 w-full max-w-2xl text-white shadow-lg max-h-[85vh] overflow-y-auto">
    <h3 class="text-xl font-semibold mb-3">SUGERENCIA: <span id="modalSugerenciaId">-</span></h3>
    <div id="modalContenido" class="flex flex-col gap-4">
      <input type="hidden" id="sugerencia_id" value="">
      <div>
        <label class="block text-sm mb-1 text-gray-300">Pregunta</label>
        <textarea id="sugerencia_descripcion" rows="3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly></textarea>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1 text-gray-300">Categoría</label>
          <input id="sugerencia_categoria" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-300">Dificultad</label>
          <input id="sugerencia_dificultad" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
        </div>
      </div>
      <div>
        <h4 class="text-lg font-semibold text-[#BC6BE8] mb-2">Respuestas</h4>
        <div class="flex flex-col gap-2">
          <div>
            <label class="block text-sm mb-1 text-green-400">Respuesta correcta:</label>
            <input id="sugerencia_rta_correcta" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 1:</label>
            <input id="sugerencia_rta_1" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 2:</label>
            <input id="sugerencia_rta_2" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 3:</label>
            <input id="sugerencia_rta_3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
        </div>
      </div>
    </div>
    <div class="flex justify-end gap-3 mt-4">
      <form id="formRechazarSugerencia" action="/paneleditor/rechazarSugerencia" method="POST" style="display:inline-block;">
        <input type="hidden" name="id_sugerencia" id="rechazar_id" value="">
        <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white">Rechazar</button>
      </form>
      <form id="formAceptarSugerencia" action="/paneleditor/aceptarSugerencia" method="POST" style="display:inline-block;">
        <input type="hidden" name="id_sugerencia" id="aceptar_id" value="">
        <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white">Aceptar</button>
      </form>
      <button onclick="cerrarModalVerSugerencia()" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-700">Cancelar</button>
    </div>
  </div>
</div>
<script>
  // Función para mostrar/ocultar el formulario de nueva pregunta
  function toggleFormulario() {
    const form = document.getElementById("formulario");
    form.classList.toggle("hidden");
  }
</script>
<script>
  // Mostrar sección preguntas por defecto y botón activo
  window.addEventListener('DOMContentLoaded', function() {
    mostrarSeccion('preguntas');
  });
  function mostrarSeccion(seccion) {
    const secPreg = document.getElementById('seccion-preguntas');
    const secRep = document.getElementById('seccion-reportes');
    const secSug = document.getElementById('seccion-sugerencias');

    // Mostrar/ocultar con inline style y con clase 'hidden' para cubrir ambos métodos
    if (secPreg) {
      if (seccion === 'preguntas') { secPreg.style.display = 'block'; secPreg.classList.remove('hidden'); } else { secPreg.style.display = 'none'; secPreg.classList.add('hidden'); }
    }
    if (secRep) {
      if (seccion === 'reportes') { secRep.style.display = 'block'; secRep.classList.remove('hidden'); } else { secRep.style.display = 'none'; secRep.classList.add('hidden'); }
    }
    if (secSug) {
      if (seccion === 'sugerencias') { secSug.style.display = 'block'; secSug.classList.remove('hidden'); } else { secSug.style.display = 'none'; secSug.classList.add('hidden'); }
    }
    // Unificar color de botón activo
    document.getElementById('btnPreguntas').classList.remove('bg-[#BC6BE8]');
    document.getElementById('btnReportes').classList.remove('bg-[#BC6BE8]');
    document.getElementById('btnSugerencias').classList.remove('bg-[#BC6BE8]');
    if (seccion === 'preguntas') {
      document.getElementById('btnPreguntas').classList.add('bg-[#BC6BE8]');
    } else if (seccion === 'reportes') {
      document.getElementById('btnReportes').classList.add('bg-[#BC6BE8]');
    } else if (seccion === 'sugerencias') {
      document.getElementById('btnSugerencias').classList.add('bg-[#BC6BE8]');
    }
  }
  window.onload = function() {
    mostrarSeccion('preguntas');
  };

  // Añadir listeners seguros a los botones de pestañas (fallback si onclick inline falla)
  document.addEventListener('DOMContentLoaded', function() {
    const bRep = document.getElementById('btnReportes');
    const bSug = document.getElementById('btnSugerencias');
    const bPreg = document.getElementById('btnPreguntas');
    if (bRep) bRep.addEventListener('click', function(e){ e.preventDefault(); mostrarSeccion('reportes'); });
    if (bSug) bSug.addEventListener('click', function(e){ e.preventDefault(); mostrarSeccion('sugerencias'); });
    if (bPreg) bPreg.addEventListener('click', function(e){ e.preventDefault(); mostrarSeccion('preguntas'); });
  });
</script>

<!-- Modal de eliminación -->
<div id="modalEliminar" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-[#1e1f3b] rounded-lg p-6 w-full max-w-md text-white shadow-lg">
    <h3 class="text-xl font-semibold mb-3">¿Estás seguro?</h3>
    <p class="text-sm text-gray-300 mb-5">Esta acción eliminará permanentemente la pregunta seleccionada.</p>
    <div class="flex justify-end gap-3">
      <button onclick="cerrarModalEliminar()" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-700">Cancelar</button>
      <button onclick="eliminarPregunta()" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700">Aceptar</button>
    </div>
  </div>
</div>

<script>
  // Variables para los modales
  let preguntaAEliminarId = null;
  const modalEliminar = document.getElementById('modalEliminar');
  const formEditar = document.getElementById('formEditar');

  // === FUNCIONES PARA ELIMINAR ===
  function abrirModalEliminar(id) {
    preguntaAEliminarId = id;
    modalEliminar.classList.remove('hidden');
    modalEliminar.classList.add('flex');
  }

  function cerrarModalEliminar() {
    modalEliminar.classList.remove('flex');
    modalEliminar.classList.add('hidden');
    preguntaAEliminarId = null;
  }

  function eliminarPregunta() {
    if (preguntaAEliminarId) {
      const form = document.createElement('form');
      form.method = 'POST';
  form.action = '/paneleditor/eliminar';
      
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'id';
      input.value = preguntaAEliminarId;
      
      form.appendChild(input);
      document.body.appendChild(form);
      form.submit();
    }
    cerrarModalEliminar();
  }

  
</script>

<script>
  document.addEventListener('click', function (e) {

    const eliminarBtn = e.target.closest('button[data-action="eliminar"]');
    if (eliminarBtn) {
      e.preventDefault();
      const id = eliminarBtn.dataset.id;
      try {
        abrirModalEliminar(id);
      } catch (err) {
        console.error('abrirModalEliminar no definida o falló:', err);
      }
      return;
    }
  });
</script>

<script>

  function abrirModalEliminarInline(id) {
    console.log('abrirModalEliminarInline called, id=', id);
    try {
      if (typeof abrirModalEliminar === 'function') {
        abrirModalEliminar(id);
      } else {
        console.error('abrirModalEliminar no está definida');
        alert('Error: función abrirModalEliminar no definida (ver consola).');
      }
    } catch (err) {
      console.error('Error en abrirModalEliminarInline:', err);
      alert('Error al abrir el modal de eliminación. Revisa la consola para más detalles.');
    }
  }

  // Registrar errores globales para ayudar a depurar problemas JS que bloqueen la página
  window.addEventListener('error', function (event) {
    console.error('Uncaught error:', event.error || event.message, event);
  });
  window.addEventListener('unhandledrejection', function (event) {
    console.error('Unhandled rejection:', event.reason);
  });
</script>

<!-- DEBUG: registrar clicks y estado de funciones para ayudar a depurar -->
<script>
  document.addEventListener('click', function (e) {
    try {
      const btn = e.target.closest('button');
      if (!btn) return;
      console.log('[DEBUG] botón clickeado:', btn.textContent.trim(), 'data-action=', btn.dataset.action, 'data-id=', btn.dataset.id);
      // comprobar si las funciones están definidas
      console.log('[DEBUG] abrirModalEliminar definida?', typeof abrirModalEliminar === 'function');
    } catch (err) {
      console.error('[DEBUG] error en listener debug:', err);
    }
  }, { capture: true });
</script>

<!-- Modal para ver sugerencia (solo lectura) -->
<div id="modalVerSugerencia" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-[#1e1f3b] rounded-lg p-6 w-full max-w-2xl text-white shadow-lg">
    <h3 class="text-xl font-semibold mb-3">Ver Sugerencia</h3>
    <div id="modalContenido" class="flex flex-col gap-4">
      <input type="hidden" id="sugerencia_id" value="">
      <div>
        <label class="block text-sm mb-1 text-gray-300">Descripción</label>
        <textarea id="sugerencia_descripcion" rows="3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly></textarea>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1 text-gray-300">Categoría</label>
          <input id="sugerencia_categoria" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-300">Dificultad</label>
          <input id="sugerencia_dificultad" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
        </div>
      </div>
      <div>
        <h4 class="text-lg font-semibold text-[#BC6BE8] mb-2">Respuestas</h4>
        <div class="flex flex-col gap-2">
          <div>
            <label class="block text-sm mb-1 text-green-400">Respuesta correcta:</label>
            <input id="sugerencia_rta_correcta" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 1:</label>
            <input id="sugerencia_rta_1" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 2:</label>
            <input id="sugerencia_rta_2" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
          <div>
            <label class="block text-sm mb-1 text-red-400">Respuesta incorrecta 3:</label>
            <input id="sugerencia_rta_3" class="w-full bg-[#11121f] border border-[#3f4477] rounded-lg p-2 text-white" readonly />
          </div>
        </div>
      </div>
    </div>
    <div class="flex justify-end gap-3 mt-4">
      <form id="formRechazarSugerencia" action="/paneleditor/rechazarSugerencia" method="POST" style="display:inline-block;">
        <input type="hidden" name="id_sugerencia" id="rechazar_id" value="">
        <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white">Rechazar</button>
      </form>
      <form id="formAceptarSugerencia" action="/paneleditor/aceptarSugerencia" method="POST" style="display:inline-block;">
        <input type="hidden" name="id_sugerencia" id="aceptar_id" value="">
        <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white">Aceptar</button>
      </form>
      <button onclick="cerrarModalVerSugerencia()" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-700">Cancelar</button>
    </div>
  </div>
</div>

<script>
  // Modal Ver Sugerencia
  function abrirModalVerSugerencia(id) {
    const modal = document.getElementById('modalVerSugerencia');
    // limpiar
    document.getElementById('sugerencia_id').value = '';
    document.getElementById('sugerencia_descripcion').value = '';
    document.getElementById('sugerencia_categoria').value = '';
    document.getElementById('sugerencia_dificultad').value = '';
    document.getElementById('sugerencia_rta_correcta').value = '';
    document.getElementById('sugerencia_rta_1').value = '';
    document.getElementById('sugerencia_rta_2').value = '';
    document.getElementById('sugerencia_rta_3').value = '';

    // setear ids en formularios
    document.getElementById('aceptar_id').value = id;
    document.getElementById('rechazar_id').value = id;
    document.getElementById('sugerencia_id').value = id;
    // mostrar id en el título
    const titleSpan = document.getElementById('modalSugerenciaId');
    if (titleSpan) titleSpan.innerText = id;

    // fetch pregunta
    fetch('/paneleditor/obtenerPregunta?id=' + encodeURIComponent(id), { credentials: 'same-origin' })
      .then(res => res.json())
      .then(data => {
        const p = data['pregunta'] || data;
        const rtas = data['respuestas'] || [];
        if (p) {
          document.getElementById('sugerencia_descripcion').value = p.descripcion || '';
          document.getElementById('sugerencia_categoria').value = p.categoria || p.categoria_nombre || '';
          document.getElementById('sugerencia_dificultad').value = p.dificultad || p.dificultad_nombre || '';
        }
        // rellenar respuestas: asumir que la respuesta correcta está marcada con es_correcta=1
        let correct = rtas.find(r => r.es_correcta == 1) || rtas[0] || {};
        const incorrectas = rtas.filter(r => r.es_correcta != 1);
        document.getElementById('sugerencia_rta_correcta').value = correct.descripcion || '';
        document.getElementById('sugerencia_rta_1').value = (incorrectas[0] && incorrectas[0].descripcion) ? incorrectas[0].descripcion : (rtas[1] ? rtas[1].descripcion : '');
        document.getElementById('sugerencia_rta_2').value = (incorrectas[1] && incorrectas[1].descripcion) ? incorrectas[1].descripcion : (rtas[2] ? rtas[2].descripcion : '');
        document.getElementById('sugerencia_rta_3').value = (incorrectas[2] && incorrectas[2].descripcion) ? incorrectas[2].descripcion : '';
      })
      .catch(err => {
        console.error('Error cargando sugerencia:', err);
        alert('No se pudo cargar la sugerencia. Revisa la consola.');
      });

    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function cerrarModalVerSugerencia() {
    const modal = document.getElementById('modalVerSugerencia');
    modal.classList.remove('flex');
    modal.classList.add('hidden');
  }
</script>

<script>
  // Modal Ver Reporte
  function abrirModalVerReporte(idReporte) {
    const modal = document.getElementById('modalVerReporte');
    // limpiar
    document.getElementById('reporte_id_field').value = '';
    document.getElementById('reporte_pregunta_id').value = '';
    document.getElementById('reporte_pregunta_descripcion').value = '';
    document.getElementById('reporte_pregunta_categoria').value = '';
    document.getElementById('reporte_pregunta_dificultad').value = '';
    document.getElementById('reporte_rta_correcta').value = '';
    document.getElementById('reporte_rta_1').value = '';
    document.getElementById('reporte_rta_2').value = '';
    document.getElementById('reporte_rta_3').value = '';
    document.getElementById('reporte_motivo').value = '';

    document.getElementById('formQuitar_id_reporte').value = '';
    document.getElementById('formEliminar_pregunta_id').value = '';

    // mostrar id en título
    const titleSpan = document.getElementById('modalReporteId');
    if (titleSpan) titleSpan.innerText = idReporte;

    fetch('/paneleditor/obtenerReporte?id=' + encodeURIComponent(idReporte), { credentials: 'same-origin' })
      .then(res => res.json())
      .then(data => {
        console.log('fetch obtenerReporte response:', data);
        if (data.error) throw new Error(data.error);
        const r = data.reporte || {};
        const p = data.pregunta || {};
        const rtas = data.respuestas || [];

        document.getElementById('reporte_id_field').value = r.id || '';
        document.getElementById('reporte_pregunta_id').value = r.pregunta_id || '';
        document.getElementById('reporte_pregunta_descripcion').value = p.descripcion || p.pregunta_descripcion || '';
        document.getElementById('reporte_pregunta_categoria').value = p.categoria || p.categoria_nombre || '';
        document.getElementById('reporte_pregunta_dificultad').value = p.dificultad || p.dificultad_nombre || '';

        let correct = rtas.find(rr => rr.es_correcta == 1) || rtas[0] || {};
        const incorrectas = rtas.filter(rr => rr.es_correcta != 1);
        document.getElementById('reporte_rta_correcta').value = correct.descripcion || '';
        document.getElementById('reporte_rta_1').value = (incorrectas[0] && incorrectas[0].descripcion) ? incorrectas[0].descripcion : (rtas[1] ? rtas[1].descripcion : '');
        document.getElementById('reporte_rta_2').value = (incorrectas[1] && incorrectas[1].descripcion) ? incorrectas[1].descripcion : (rtas[2] ? rtas[2].descripcion : '');
        document.getElementById('reporte_rta_3').value = (incorrectas[2] && incorrectas[2].descripcion) ? incorrectas[2].descripcion : '';

        document.getElementById('reporte_motivo').value = r.descripcion || '';

        // set hidden inputs for forms
        document.getElementById('formQuitar_id_reporte').value = r.id || '';
        document.getElementById('formEliminar_pregunta_id').value = r.pregunta_id || '';
      })
      .catch(err => {
        console.error('Error cargando reporte:', err);
        alert('No se pudo cargar el reporte. Revisa la consola.');
      });

    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function cerrarModalVerReporte() {
    const modal = document.getElementById('modalVerReporte');
    modal.classList.remove('flex');
    modal.classList.add('hidden');
  }
</script>



